'use strict';(function(f,d,e){var b=function(){_.extend(this,Backbone.Events);this.layout=new b.Layout;this.menuscene=new b.MenuScene(this.layout.canvas);this.gridscene=new b.GridScene(this.layout.canvas);this.layereditor=new b.LayerEditor(this.menuscene);this.dirty=!1;this.setupEvents()};b.prototype.setupEvents=function(){this.gridscene.on("new",function(a,b){this.dirty=!0},this)};b.prototype.getPath=function(a){return a?globalPath+'/media/clients/'+APP_ENV.client.fk_clients+"/":globalPath+'/images/designer/'};b.prototype.clientPath=
function(a){a=a||"";var b=!0;"__"==this.fileName(a).substring(0,2)&&(b=!1);return this.getPath(b)+this.fileName(a)};b.prototype.fileName=function(a){return a.split("/").pop()};b.prototype.notice=function(a,b){return $.notify({message:a},{type:b,z_index:1060})};Object.defineProperties(b.prototype,{layout:{configurable:!0,enumerable:!0,get:function(){return this._layout?this._layout:e},set:function(a){this._layout=a}},menuscene:{configurable:!0,enumerable:!0,get:function(){return this._menuscene?this._menuscene:
e},set:function(a){this._menuscene=a}},gridscene:{configurable:!0,enumerable:!0,get:function(){return this._gridscene?this._gridscene:e},set:function(a){this._gridscene=a}},layereditor:{configurable:!0,enumerable:!0,get:function(){return this._layereditor?this._layereditor:e},set:function(a){this._layereditor=a}},dirty:{configurable:!0,enumerable:!0,get:function(){return this._dirty},set:function(a){this._dirty!=a&&(this._dirty=a,this.trigger("dirty",{event:"dirty",dirty:a}))}},canvas:{configurable:!0,
enumerable:!0,get:function(){return this.layout?this.layout.canvas:e}}});Object.defineProperties(b,{Layout:{configurable:!0,enumerable:!0,get:function(){return this._Layout?this._Layout:e},set:function(a){this._Layout=a}},MenuScene:{configurable:!0,enumerable:!0,get:function(){return this._MenuScene?this._MenuScene:e},set:function(a){this._MenuScene=a}},GridScene:{configurable:!0,enumerable:!0,get:function(){return this._GridScene?this._GridScene:e},set:function(a){this._GridScene=a}},LayerEditor:{configurable:!0,
enumerable:!0,get:function(){return this._LayerEditor?this._LayerEditor:e},set:function(a){this._LayerEditor=a}}});f.Designer=b})(window,document);
(function(f,d,e){var b=function(a){_.extend(this,Backbone.Events);this.canvas=oCanvas.create(b.defaults.canvas)};Object.defineProperties(b.prototype,{el:{configurable:!0,enumerable:!0,get:function(){return this.canvas.canvasElement}},background:{configurable:!0,enumerable:!0,get:function(){var a=designer.layout.canvas.canvasElement.style.backgroundImage;""!=a&&(a=a.match(/\/(clients|designer).*\.png/)[0].split("/").pop());return a},set:function(a){0<=a.indexOf(".wmv")?this.backgroundVideo=a:designer.layout.canvas.canvasElement.style.backgroundImage=
"url('"+designer.clientPath(a)+"')"}},backgroundVideo:{configurable:!0,enumerable:!0,get:function(){return this.background.replace("-snap.png",".wmv")},set:function(a){this.background=a.split(".").shift()+"-snap.png";return this}}});Object.defineProperties(b,{defaults:{configurable:!0,enumerable:!0,get:function(){return{canvas:{canvas:"#canvas",background:"transparent"},font:{font:"normal normal normal 32px Sans-Serif",colour:"#000"}}}}});f.Designer.Layout=b})(window,document);
(function(f,d,e){var b=function(a,g){_.extend(this,Backbone.Events);this._menuscene=a;this.el.addEventListener("dragover",b.handleDragOver,!1);this.el.addEventListener("drop",b.handleDrop,!1);this.el.addEventListener("click",b.handleClick,!1)};b.prototype.updateLayerWidgets=function(){mbd.propertyEditor.propertyBarDestroy();$("#"+designer.layereditor.el.id+" div").each(function(a,b){d.getElementById(b.id).setAttribute("data-layer",a);b=b.id.replace("tl","");b=designer.menuscene.getWidgetById(b);b.zIndex=
a;b.redraw()});designer.dirty=!0};b.handleClick=function(a){a=a.target.id.replace("tl","");a=designer.menuscene.getWidgetById(a);mbd.propertyEditor.handleMdWidgetClick.call(a)};b.handleDragStart=function(a){a.dataTransfer.effectAllowed="move";a.dataTransfer.setData("text",a.target.id);this.style.opacity="0.4"};b.handleDragOver=function(a){a.preventDefault();a.dataTransfer.dropEffect="move";return!1};b.handleDrop=function(a){a.stopPropagation();var b=d.getElementById(a.dataTransfer.getData("text"));
b.style.opacity="1";a="DIV"==a.srcElement.tagName?$(a.srcElement):$(a.srcElement.parentElement);b.getAttribute("data-layer")>a.data("layer")?a.before(b):a.after(b);designer.layereditor.updateLayerWidgets();return!1};b.prototype.createCloneButton=function(){var a=d.createElement("i");a.classList.add("btn","fa","fa-clone","pull-right","hide");a.setAttribute("title","Clone");a.textContent=" Duplicate";a.addEventListener("click",function(){var a=designer.menuscene.getWidgetProperties(mbd.property,!0);
a.x+=50;a.y+=50;designer.menuscene.addWidget(a);designer.layereditor.layersUpdate()});return a};b.prototype.layersUpdate=function(){var a=[],g=designer.gridscene.hideLines();designer.menuscene.forFachWidget(function(c,g){g=d.createElement("span");g.classList.add("pull-left","title");g.textContent=c.type.toTitleCase();"text"==c.type?g.textContent+=": "+c.text.substring(0,20)+(20<c.text.length?"...":""):"image"==c.type&&(g.textContent+=": "+c.image.split("/").pop().split(".").shift());var e=designer.layereditor.createCloneButton(),
h=d.createElement("div");h.id="tl"+c.id.toString();h.setAttribute("draggable",!0);h.setAttribute("data-layer",c.zIndex);h.classList.add("layers");h.appendChild(g);h.appendChild(e);h.addEventListener("dragstart",b.handleDragStart,!1);a[c.zIndex-designer.gridscene.lines]=h});g&&designer.gridscene.showLines();designer.layereditor.el.innerHTML="";_(a).each(function(a){designer.layereditor.el.appendChild(a)});null!==mbd.property&&0<mbd.property.children.length&&null!==d.getElementById("lt"+mbd.property.id)&&
(d.getElementById("tl"+mbd.property.id).classList.add("active"),$(d.getElementById("tl"+mbd.property.id)).children("i").removeClass("hide"));return this};Object.defineProperties(b.prototype,{el:{configurable:!0,enumerable:!0,get:function(){return d.getElementById("layers")}}});f.Designer.LayerEditor=b})(window,document);
(function(f,d,e){var b=function(a,g){_.extend(this,Backbone.Events);this.workspace={};this.canvas=a;this.options=_.defaults(I.pick(g||{},b.validOptions),b.defaults);this.setupEnv();this.createScene().load()};b.prototype.setupEnv=function(){if(I(Logger).isObject()){this.logger=Logger.get("MenuScene");var a=function(a,b,d){this.setLevel(b)},a=_.bind(a,this.logger);this.options.watch("logLevel",a)}};b.prototype.setLogLevel=function(){return this._scene.loaded};b.prototype.load=function(){this.active||
(this.canvas.scenes.load(b.sceneName),this.trigger("load",this));return this};b.prototype.unload=function(){this.loaded&&(this.canvas.scenes.unload(b.sceneName),this.trigger("unload",this));return this};b.prototype.createScene=function(){"undefined"===typeof this._scene&&(this._scene=this.canvas.scenes.create(b.sceneName,function(){}),this.trigger("create",this));return this};b.prototype.forFachWidget=function(a){I(this._scene.objects).each(a);return this};b.prototype.getWidgetById=function(a){return this._scene.objects.find(function(b){if(b.id==
a)return b})};b.prototype.addWidget=function(a){var b;switch(a.type){case "text":b=this.canvas.display.text(a);break;case "line":b=this.canvas.display.line(a);b.bind("mousemove",mbd.propertyEditor.handleMdWidgetMouseMove);break;case "image":a.image=designer.clientPath(a.image),b=this.canvas.display.image(a)}mbd.propertyEditor.dragAndDrop(b);b.bind("click tap",mbd.propertyEditor.handleMdWidgetClick);b.bind("mouseenter",mbd.propertyEditor.handleMdWidgetMouseEnter);b.bind("mouseleave",mbd.propertyEditor.handleMdWidgetMouseLeave);
this._scene.add(b);this.logger.debug("Added { id => "+b.id+", title => "+this.getWidgetTitle(b)+" }");this.trigger("widget-add",b);designer.dirty=!0;return this};b.prototype.getWidgetTitle=function(a){var b=a.type.toTitleCase();"image"==a.type?b+=": "+a.image:"text"==a.type&&(b+=": "+a.text);return b};b.prototype.removeWidget=function(a){a.remove();this.logger.info("Removed { id => "+a.id+", title => "+this.getWidgetTitle(a)+" }");designer.dirty=!0;this.trigger("widget-remove",a);return this};b.prototype.getWidgetProperties=
function(a,b){var c={};!1===(I(b).isBoolean()?b:!1)&&(c.id=a.id,c.zIndex=a.zIndex);c.x=a.x;c.y=a.y;c.height=a.height;c.width=a.width;c.type=a.type;c.rotation=a.rotation;"text"===a.type&&(c.font=a.font,c.text=a.text,c.fill=a.fill);"line"===a.type&&(c.start=a.start,c.end=a.end,c.stroke=a.stroke,c.cap=a.cap);if("text"===a.type||"line"===a.type)c.shadow=a.shadow;"image"===a.type&&(c.image=designer.fileName(a.image));return c};b.prototype.serializeScene=function(){for(var a=[],b=0;b<this.widgets.length;b++){var c=
this.widgets[b];c.pointerEvents&&(a[c.zIndex]=this.getWidgetProperties(c))}return JSON.stringify(a)};Object.defineProperties(b.prototype,{loaded:{configurable:!0,enumerable:!0,get:function(){return this._scene.loaded}},active:{configurable:!0,enumerable:!0,get:function(){return this.loaded&&this.canvas.scenes.current==b.sceneName}},widgets:{configurable:!0,enumerable:!0,get:function(){return this._scene.objects}}});Object.defineProperties(b,{sceneName:{configurable:!0,enumerable:!0,get:function(){return"menu"}},
validOptions:{configurable:!0,enumerable:!0,get:function(){return["logLevel"]}},defaults:{configurable:!0,enumerable:!0,get:function(){return{logLevel:APP_ENV.logLevel}}},events:{configurable:!0,enumerable:!0,get:function(){return["create","load","unload"]}}});f.Designer.MenuScene=b})(window,document);
(function(f,d,e){d=function(b,a){_.extend(this,Backbone.Events);this.name="grid";this.defaults={snapTo:20,width:1,colour:"#D4D4D4",snap:!0};this.current={snapTo:0,width:0,colour:""};this.createGrid=_.throttle(this._createGrid,3E3,a);this.canvas=b;a=_.pick(a,this.validOptions);_.defaults(a,this.defaults);this.createGrid(a);this._snap=!0};d.prototype.showLines=function(){return this.visible?!1:(this.canvas.scenes.load(this.name),this.trigger("load",this.current,this.state),!0)};d.prototype.hideLines=
function(){return this.visible?(this.canvas.scenes.unload(this.name),this.trigger("unload",this.current,this.state),!0):!1};d.prototype.nextGridLine=function(b){return(Math.floor((b||0)/this.snapTo)+1)*this.snapTo};d.prototype._createGrid=function(b){var a=!1;this._scene!==e&&(a=this.hideLines());b=I.pick(b,this.validOptions);_.defaults(b,this.current);I.isEqual(b,this.current)||(this.emptyGrid(b),this.addLines(b)&&(this.current=b,this.trigger("new",b,this.state),a&&this.showLines()));return this};
d.prototype.emptyGrid=function(b){this._scene=this.canvas.scenes.create(this.name,function(){});this.trigger("empty",b,this.state);return!0};d.prototype.addLines=function(b){if(0<this._scene.objects.length)return!1;this.hideLines();this.addLinesToAxis("x",b);this.addLinesToAxis("y",b);return!0};d.prototype.addLinesToAxis=function(b,a){var d=a.snapTo,c,e,f,h,k;"x"==b?(c=f=d,e=0,h=this.canvas.height,k=this.canvas.width):"y"==b&&(c=0,f=this.canvas.width,e=h=d,k=this.canvas.height);for(;d<k;){var l=this.canvas.display.line({start:{x:c,
y:e},end:{x:f,y:h},stroke:a.width+"px "+a.colour,cap:"butt",pointerEvents:!1});this._scene.add(l);d+=a.snapTo;"x"==b?c=f=d:"y"==b&&(e=h=d)}return!0};Object.defineProperties(d.prototype,{events:{configurable:!0,enumerable:!0,get:function(){return["empty","new","load","unload"]}},validOptions:{configurable:!0,enumerable:!0,get:function(){return["snapTo","width","colour","snap"]}},lines:{configurable:!0,enumerable:!0,get:function(){return this._scene===e?0:this.visible?this._scene.objects.length:0}},
snap:{configurable:!0,enumerable:!0,get:function(){return this.current.snap},set:function(b){this.current.snap=!0===b?!0:!1;return this}},snapTo:{configurable:!0,enumerable:!0,get:function(){return this.current.snapTo}},visible:{configurable:!0,enumerable:!0,get:function(){return this._scene.loaded},set:function(b){!0===b?this.showLines():this.hideLines();return this}},state:{configurable:!0,enumerable:!0,get:function(){return{visible:this._scene.loaded,lines:this.lines}}}});f.Designer.GridScene=
d})(window,document);
//# sourceMappingURL=/js/designer.bundle.min.map
