(function(l, h, a, k) {
    var f, d = {
        init: function() {
            a("button.upload").on("click", function(b) {
                b.preventDefault();
                a(".uploader-inline").show();
                a(".gallery-view").hide().find("figure.centered").remove()
            });
            a(".gallery").on("click", function(a) {
                a.preventDefault();
                d.showFiles()
            });
            a("button.modal-toggle").on("click", function(b) {
                b.preventDefault();
                a("#modal-imgupload").fadeToggle(850);
                a(".gallery").click()
            });
            d.abourtXHR(f);
            a("#imgajax").on("change", function(b) {
                b.preventDefault();
                a("#upload").submit();
                a("#imgajax").replaceWith(a("#imgajax").val("").clone(!0))
            });
            a("#upload").on("submit", function(b) {
                b.preventDefault();
                a(this).ajaxSubmit({
                    target: "#output",
                    beforeSubmit: function() {},
                    success: function() {
                        a("#progressbox").delay(1E3).fadeOut(1E3, function() {
                            a("#progressbar").width("0%")
                        })
                    },
                    uploadProgress: function(b, c, e, d) {
                        e = (new Date - window.dlStart) / c * (e - c);
                        parseInt(e % 1E3 / 100);
                        b = parseInt(e / 1E3 % 60);
                        c = parseInt(e / 6E4 % 60);
                        e = parseInt(e / 36E5 % 24);
                        b = ((10 > e ? "0" + e : e) + ":" + (10 > c ? "0" + c : c) + ":" + (10 > b ? "0" + b : b)).trimCharsLeft("00:");
                        a("#progressbox").show();
                        a("#progressbar").width(d +
                            "%");
                        a("#statustxt").html(d + "% (" + b + ")")
                    },
                    resetForm: !0
                });
                window.dlStart = new Date
            })
        },
        showMessages: function(b, d, c, e) {
            var g = h.createElement(d);
            g.className += e;
            g.innerHTML = b;
            a(c).append(g).slideDown(1E3, function(b) {
                setTimeout(function() {
                    a(d).slideUp(1E3, function() {
                        a(this).fadeOut("slow", function() {
                            a(this).remove()
                        })
                    })
                }, 6E3)
            })
        },
        setAjaxResponse: function(b, f, c) {
            "undefined" !== typeof b && typeof b !== k && (a(c).append(a("<div class='dinamicly-div-append-wrapper'></div>")), a.each(b, function(b, c) {
                1 < c.length ? a.each(c,
                    function(a, c) {
                        d.showMessages(c, f, "div.dinamicly-div-append-wrapper", "image-upload-message " + b)
                    }) : d.showMessages(c, f, "div.dinamicly-div-append-wrapper", "image-upload-message " + b)
            }))
        },
        showFiles: function() {
            a(".large-image").attr("src", "/images/default.png");
            a(".uploader-inline, .large-image").hide();
            a(".gallery-view").find("figure.centered").not(".large-image").remove();
            a(".gallery-view, .ajax-loader").show();
            d.abourtXHR(f);			
            f = a.get("/menus/listimages.php", function(b) {
				b = jQuery.parseJSON(b); 

                a(".ajax-loader").hide();
                a(".large-image").show();
				console.log(b.files);
                b.files && (a.each(b.files, function(b, c) {
                    a("div.image-grid").append("<figure class='centered'><i class='glyphicon glyphicon-ok selectimg' style='display: none;'></i><i class='glyphicon glyphicon-remove deleteimg'></i><img aria-checked='false' aria-label='" + c.filename + "' src='" + c.filelink + "' class='thumbnail' alt='" + c.filename + "' title='" + c.filename + "' /></figure>")
                }), d.viewImage(), d.deleteImage(), d.selectImage())
            })
        },
        selectImage: function() {
            d.abourtXHR(f);
            a(".selectimg").on("click", function(b) {
                console.log(a(this).next().next("img").attr("src"))
            })
        },
        viewImage: function() {
            a(".thumbnail").on("click", function(b) {
                b.preventDefault();
                a(".thumbnail").removeClass("image-border").attr("aria-checked", !1);
                a(this).addClass("image-border").attr("aria-checked", !0);
                a(".large-image").attr("src", a(this).attr("src"))
            });
            a(".large-image").attr("src", a(".thumbnail").first().attr("src"))
        },
        deleteImage: function() {
            d.abourtXHR(f);
            a(".deleteimg").on("click", function(b) {
                f = a.post("/menus/image_delete.php", {
                    img: a(this).next("img").attr("src")
                }, function() {
                    d.showFiles()
                })
            })
        },
        abourtXHR: function(a) {
            a && 4 !== a.readyState && a.abort()
        }
    };
    d.init();
    a(h).ready(function(a) {})
})(this, document, jQuery);